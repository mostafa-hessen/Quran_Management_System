<!--
Ù…Ù„Ù: Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†
Ø§Ù„ÙˆØµÙ: Ù…Ø³ØªÙ†Ø¯ ÙŠØ¬Ù…Ø¹ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ° (Requirements + Modules) + Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ø¬Ù‡Ø© Ø£ÙˆÙ„ÙŠ ÙˆØ§Ø­Ø¯ÙŠ (HTML/CSS/JS)
Ù„ØºØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: Ø¹Ø±Ø¨ÙŠØ© (RTL)

---
Ø¬Ø²Ø¡ Ø£ÙˆÙ„: Ù…ÙˆØ§ØµÙØ§Øª ØªÙ†ÙÙŠØ°ÙŠØ© Ù…Ø®ØªØµØ±Ø© (Requirements)

1) Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
   - Ù†Ø¸Ø§Ù… ÙˆÙŠØ¨ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†: Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© (Admin Dashboard)ØŒ ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¹Ù„Ù…ØŒ ÙˆØ§Ø¬Ù‡Ø© Ø·Ø§Ù„Ø¨/ÙˆÙ„ÙŠ Ø£Ù…Ø±.
   - Ù…ÙƒÙˆÙ† Ø£Ø³Ø§Ø³ÙŠ: Ù†Ø¸Ø§Ù… Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆÙ…Ø¯ÙÙˆØ¹Ø§Øª.
   - ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª (Charts, exportable CSV/PDF).

2) Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø±
   - Admin (Ù…Ø´Ø±Ù): ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©.
   - Teacher (Ù…Ø¹Ù„Ù…): Ø¥Ø¯Ø§Ø±Ø© Ø­Ù„Ù‚Ø§ØªÙ‡ØŒ Ø­Ø¶ÙˆØ±ØŒ ØªÙ‚ÙŠÙŠÙ… Ø·Ù„Ø§Ø¨.
   - Student (Ø·Ø§Ù„Ø¨): Ù…Ù„Ù Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ Ø§Ù„Ø­Ø¶ÙˆØ±.
   - Parent (ÙˆÙ„ÙŠ Ø£Ù…Ø±): Ù…Ø´Ø§Ù‡Ø¯Ø© ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø·ÙÙ„ ÙˆØ¯ÙØ¹ Ø§Ø´ØªØ±Ø§Ùƒ.

3) Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
   - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (CRUD) Ù…Ø¹ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ­Ù‚ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª.
   - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª (CRUD) + Ø±Ø¨Ø· Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ·Ù„Ø§Ø¨.
   - Ø­Ø¶ÙˆØ± Ø§Ù„Ø¬Ù„Ø³Ø§Øª: ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© (Ø­Ø§Ø¶Ø±ØŒ ØºØ§Ø¦Ø¨ØŒ Ù…ØªØ£Ø®Ø±ØŒ Ø¨Ø¹Ø°Ø±).
   - ØªØ³Ø¬ÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: Ø³ÙˆØ±Ø©ØŒ Ø¢ÙŠØ© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©/Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ Ø¹Ø¯Ø¯ Ø¢ÙŠØ§ØªØŒ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¥ØªÙ‚Ø§Ù†ØŒ Ø£Ø®Ø·Ø§Ø¡.
   - Ù†Ø¸Ø§Ù… Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø¨Ø§Ù‚Ø§Øª (Ø´Ù‡Ø±ÙŠØŒ Ø³Ù†ÙˆÙŠ)ØŒ Ø±Ø¨Ø· Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨ØŒ Ù…Ø¯ÙÙˆØ¹Ø§ØªØŒ ØªØ°ÙƒÙŠØ± Ù‚Ø±Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡.
   - ØªÙ‚Ø§Ø±ÙŠØ±: Ø­Ø¶ÙˆØ±ØŒ ØªÙ‚Ø¯Ù… Ø­ÙØ¸ÙŠØŒ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ©ØŒ ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ù„Ù‚Ø§Øª.
   - Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© (web notifications).

4) Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©
   - Ø£Ø¯Ø§Ø¡: ØµÙØ­Ø§Øª ØªØ­Ù…ÙŠÙ„ Ø³Ø±ÙŠØ¹Ø©ØŒ ØªØµÙØ­ Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø­ØªÙ‰ 10k Ø³Ø¬Ù„ (paging + server-side filtering).
   - Ø£Ù…Ø§Ù†: Ù…ØµØ§Ø¯Ù‚Ø© (JWT Ø£Ùˆ Ø¬Ù„Ø³Ø§Øª) + ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø¬Ù„Ø§Øª.
   - Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¯ÙˆØ±ÙŠ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
   - ÙˆØµÙˆÙ„ APIs RESTful + ÙˆØ«Ø§Ø¦Ù‚ (OpenAPI/Swagger).

5) ØªÙ‚Ù†ÙŠØ§Øª Ù…Ù‚ØªØ±Ø­Ø©
   - Frontend: HTML5, CSS3 (Sass if preferred) + Vanilla JS Ø£Ùˆ React/Vue.
   - Backend: Node.js (Express) Ø£Ùˆ Laravel (PHP) Ø£Ùˆ Django.
   - DB: PostgreSQL / MySQL.
   - Payments: Stripe / PayTabs / Fawry (Ø­Ø³Ø¨ Ø§Ù„Ø¨Ù„Ø¯).
   - Hosting: Vercel/Netlify (frontend) + DigitalOcean/AWS (backend + DB).

---
Ø¬Ø²Ø¡ Ø«Ø§Ù†ÙŠ: Modules (Modules / Endpoints / Data models)

Module: Auth
  - POST /api/auth/login
  - POST /api/auth/logout
  - POST /api/auth/refresh
  - POST /api/auth/register (admin only)

Module: Users
  - GET /api/users?role=teacher|student|parent
  - GET /api/users/:id
  - POST /api/users
  - PUT /api/users/:id
  - DELETE /api/users/:id
  - Data model (users): id, name, email, phone, role, status, join_date, profile_pic

Module: Halaqat (Circles)
  - GET /api/halaqat
  - POST /api/halaqat
  - PUT /api/halaqat/:id
  - DELETE /api/halaqat/:id
  - Data model (halaqa): id, name, teacher_id, stage, max_students, schedule (days+time)

Module: Attendance
  - POST /api/halaqat/:id/sessions (create session)
  - POST /api/sessions/:session_id/attendance (list of student statuses)
  - GET /api/users/:id/attendance

Module: Performance
  - POST /api/performance (student_id, session_id, type, surah, from_ayah, to_ayah, score, notes)
  - GET /api/users/:id/performance

Module: Subscriptions & Payments
  - GET /api/subscriptions/packages
  - POST /api/subscriptions/packages
  - PUT /api/subscriptions/packages/:id
  - POST /api/subscriptions/assign (student_id, package_id, start_date)
  - GET /api/users/:id/subscriptions
  - POST /api/payments (amount, method, ref, student_id)
  - Webhook endpoint: POST /api/payments/webhook
  - Data model (packages): id, title, price, duration_days, type (individual|halaqa), features
  - Data model (subscription): id, student_id, package_id, start_date, end_date, status

Module: Reports
  - GET /api/reports/attendance?from=&to=&halaqa_id=
  - GET /api/reports/progress?student_id=&from=&to=
  - Export: /api/reports/export?type=csv|pdf

---
Ø¬Ø²Ø¡ Ø«Ø§Ù„Ø«: Ù†Ù…ÙˆØ°Ø¬ Ù…Ø®Ø·Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®ØªØµØ± (entities)
  - users
  - halaqat
  - halaqa_students (halaqa_id, student_id)
  - sessions (halaqa_id, date)
  - attendance (session_id, student_id, status, timestamp)
  - performance
  - subscriptions
  - packages
  - payments

---
Ø¬Ø²Ø¡ Ø±Ø§Ø¨Ø¹: Ø³ÙŠØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª (Subscription flow)
 1) Admin ÙŠÙ†Ø´Ø¦ Ø¨Ø§Ù‚Ø© (Ù…Ø¯Ø©ØŒ Ø³Ø¹Ø±ØŒ Ù†ÙˆØ¹).
 2) Parent/Student ÙŠØ®ØªØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆÙŠØ¯ÙØ¹ (redirect Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ Ø£Ùˆ Ø¯Ø§Ø®Ù„-app).
 3) Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹ ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ±Ø¨Ø· Ø§Ù„Ø·Ø§Ù„Ø¨.
 4) Ù†Ø¸Ø§Ù… ÙŠÙ‚ÙˆÙ… Ø¨ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ù…Ø«Ù„Ø§Ù‹ 7 Ø£ÙŠØ§Ù…ØŒ 3 Ø£ÙŠØ§Ù…).
 5) Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØªÙ…Ù†Ø¹ Ø£Ùˆ ØªØ³Ù…Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù„Ø­Ø¬Ø² Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù„Ù‚Ø©).

---
Ø¬Ø²Ø¡ Ø®Ø§Ù…Ø³: ÙˆØ§Ø¬Ù‡Ø§Øª/Ø´Ø§Ø´Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
  - Login
  - Dashboard (Ø£Ø¹Ù„Ù‰: Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©ØŒ ÙˆØ³Ø·: ØªÙ‚Ø§Ø±ÙŠØ± Ø³Ø±ÙŠØ¹Ø©ØŒ Ø£Ø³ÙÙ„: Ø¢Ø®Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø«)
  - Students (Ù‚Ø§Ø¦Ù…Ø©ØŒ Ø¨Ø­Ø«ØŒ ÙÙ„ØªØ±ØŒ export)
  - Teachers
  - Halaqat (Ù‚ÙˆØ§Ø¦Ù…ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„)
  - Sessions & Attendance
  - Performance (Ø³Ø¬Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ØŒ ØªÙ‚ÙŠÙŠÙ…)
  - Subscriptions & Payments (Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ù‚Ø©ØŒ Ø±Ø¨Ø·ØŒ ØªÙ„Ù‚ÙŠÙ…Ø§Øª Ù…Ø§Ù„ÙŠØ©)
  - Reports
  - Settings (roles & permissions, payment gateways)

-->

<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† (Ø¨Ø±ÙˆØªÙˆØªØ§ÙŠØ¨)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --muted:#6b7280; --accent:#0ea5a4; --accent-2:#06b6d4; --danger:#ef4444;
      --sidebar:#0f1724; --sidebar-text:#e6eef6;
    }
    *{box-sizing:border-box;font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans Arabic', 'Helvetica Neue', Arial}
    body{margin:0;background:var(--bg);color:#0f1724}
    .app{display:flex;min-height:100vh}
    /* Sidebar */
    .sidebar{width:260px;background:linear-gradient(180deg,var(--sidebar),#0b1220);color:var(--sidebar-text);padding:20px;}
    .brand{font-size:18px;font-weight:700;margin-bottom:18px}
    .nav{margin-top:12px}
    .nav a{display:flex;gap:12px;align-items:center;padding:10px;border-radius:8px;color:var(--sidebar-text);text-decoration:none;margin-bottom:6px}
    .nav a:hover{background:rgba(255,255,255,0.03)}
    .nav a .icon{width:28px;height:28px;background:rgba(255,255,255,0.06);display:inline-flex;align-items:center;justify-content:center;border-radius:6px}

    /* Main */
    .main{flex:1;padding:18px 24px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .search{display:flex;gap:8px;align-items:center}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-bottom:18px}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 1px 2px rgba(16,24,40,0.04)}
    .kpi{font-size:22px;font-weight:700}
    .kpi-sub{font-size:12px;color:var(--muted)}

    /* layout */
    .grid-2{display:grid;grid-template-columns:2fr 1fr;gap:14px}

    /* table */
    table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden}
    th,td{padding:10px;text-align:right;border-bottom:1px solid #f1f5f9}
    thead th{background:#fbfdfe;font-weight:600}

    /* small components */
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:var(--accent);color:white;text-decoration:none;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(14,165,164,0.12)}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:#eef6f6;color:var(--accent-2);font-weight:700}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center}
    .modal{background:var(--card);padding:18px;border-radius:10px;width:520px}

    /* responsive */
    @media(max-width:900px){.sidebar{display:none}.main{padding:12px}}

    /* RTL adjustments */
    .dir-rtl{text-align:right}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†</div>
      <div class="muted">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
      <nav class="nav" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
        <a href="#" onclick="openPage('dashboard')"><span class="icon">ğŸ </span> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
        <a href="#" onclick="openPage('students')"><span class="icon">ğŸ§‘â€ğŸ“</span> Ø§Ù„Ø·Ù„Ø§Ø¨</a>
        <a href="#" onclick="openPage('teachers')"><span class="icon">ğŸ‘¨â€ğŸ«</span> Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</a>
        <a href="#" onclick="openPage('halaqat')"><span class="icon">ğŸ•Œ</span> Ø§Ù„Ø­Ù„Ù‚Ø§Øª</a>
        <a href="#" onclick="openPage('attendance')"><span class="icon">ğŸ“‹</span> Ø§Ù„Ø­Ø¶ÙˆØ±</a>
        <a href="#" onclick="openPage('subscriptions')"><span class="icon">ğŸ’³</span> Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</a>
        <a href="#" onclick="openPage('reports')"><span class="icon">ğŸ“Š</span> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
        <a href="#" onclick="openPage('settings')"><span class="icon">âš™ï¸</span> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
      </nav>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="search">
          <input id="globalSearch" oninput="renderActivePage()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø­Ù„Ù‚Ø©..." style="padding:8px;border-radius:8px;border:1px solid #e6eef6;width:320px">
          <button class="btn ghost" onclick="openModal('createStudent')">+ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        </div>
        <div>
          <span class="badge">Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†: <strong id="countSubscribers">0</strong></span>
          <button class="btn" onclick="openPage('subscriptions')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</button>
        </div>
      </div>

      <!-- Pages container (simple single-page switching)-->
      <section id="page-dashboard" class="page">
        <div class="cards">
          <div class="card">
            <div class="kpi" id="kpiStudents">0</div>
            <div class="kpi-sub">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
          </div>
          <div class="card">
            <div class="kpi" id="kpiTeachers">0</div>
            <div class="kpi-sub">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</div>
          </div>
          <div class="card">
            <div class="kpi" id="kpiHalaqat">0</div>
            <div class="kpi-sub">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù„Ù‚Ø§Øª</div>
          </div>
          <div class="card">
            <div class="kpi" id="kpiActiveSubs">0</div>
            <div class="kpi-sub">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <div class="card">
              <h3>Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
              <table id="studentsTable">
                <thead><tr><th>Ø§Ø³Ù…</th><th>Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¨Ø§Ù‚Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="card" style="margin-top:14px">
              <h3>Ø£Ø­Ø¯Ø§Ø« Ø³Ø±ÙŠØ¹Ø©</h3>
              <ul id="activityList" style="padding-left:0;list-style:none;margin:0"></ul>
            </div>
          </div>

          <div>
            <div class="card">
              <h3>Ù…Ø®Ø·Ø· ØªØ·ÙˆØ± Ø§Ù„Ø·Ø§Ù„Ø¨ (ØªØ¬Ø±ÙŠØ¨ÙŠ)</h3>
              <canvas id="chartProgress" width="300" height="180"></canvas>
            </div>

            <div class="card" style="margin-top:14px">
              <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ù…Ø§Ù„ÙŠØ©</h3>
              <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª: <strong id="totalPayments">0</strong> Ø¬.Ù…</div>
              <div>Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª: <strong id="duePayments">0</strong> Ø¬.Ù…</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Students Page -->
      <section id="page-students" class="page" style="display:none">
        <div class="card">
          <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
          <div style="margin-bottom:10px;display:flex;gap:8px;justify-content:flex-end">
            <button class="btn" onclick="exportCSV('students')">ØªØµØ¯ÙŠØ± CSV</button>
          </div>
          <table id="studentsFullTable"><thead><tr><th>Ø§Ø³Ù…</th><th>Ù‡Ø§ØªÙ</th><th>Ø§Ù†Ø¶Ù…</th><th>Ø­Ø§Ù„Ø©</th><th>Ø­Ù„Ù‚Ø©</th><th>Ø¨Ø§Ù‚Ø©</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <!-- Subscriptions Page -->
      <section id="page-subscriptions" class="page" style="display:none">
        <div class="card">
          <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h3>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-bottom:10px">
            <button class="btn" onclick="openModal('createPackage')">+ Ø¨Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
          </div>
          <table id="packagesTable"><thead><tr><th>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ù…Ø¯Ø© (ÙŠÙˆÙ…)</th><th>Ù†ÙˆØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody></tbody></table>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
          <table id="paymentsTable"><thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>ØªØ§Ø±ÙŠØ®</th></tr></thead><tbody></tbody></table>
        </div>
      </section>

      <!-- Other pages placeholders -->
      <section id="page-teachers" class="page" style="display:none"><div class="card"><h3>Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</h3><p>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ§Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù„Ù‚Ø§Øª</p></div></section>
      <section id="page-halaqat" class="page" style="display:none"><div class="card"><h3>Ø§Ù„Ø­Ù„Ù‚Ø§Øª</h3><p>Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆÙ†Ù‚Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨</p></div></section>
      <section id="page-attendance" class="page" style="display:none"><div class="card"><h3>Ø§Ù„Ø­Ø¶ÙˆØ±</h3><p>ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ù„ÙƒÙ„ Ø¬Ù„Ø³Ø©</p></div></section>
      <section id="page-reports" class="page" style="display:none"><div class="card"><h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3><p>ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø¶ÙˆØ±ØŒ ØªÙ‚Ø¯Ù…ØŒ Ù…Ø§Ù„ÙŠ</p></div></section>
      <section id="page-settings" class="page" style="display:none"><div class="card"><h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3><p>Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ØŒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§ØªØŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©</p></div></section>

    </main>
  </div>

  <!-- Modal backdrop -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal" id="modalContent"></div>
  </div>

  <script>
    // --------- Demo data (simulate backend) ----------
    const db = {
      students: [
        {id:1,name:'Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',phone:'01012345678',joined:'2025-01-10',status:'Ù†Ø´Ø·',halaqa:'Ø§Ù„Ø­Ù„Ù‚Ø© 1',packageId:1},
        {id:2,name:'Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯',phone:'01198765432',joined:'2024-12-20',status:'Ù†Ø´Ø·',halaqa:'Ø§Ù„Ø­Ù„Ù‚Ø© 2',packageId:2},
        {id:3,name:'Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†',phone:'0105554433',joined:'2024-11-01',status:'Ù…ÙˆÙ‚ÙˆÙ',halaqa:'',packageId:null}
      ],
      teachers:[{id:1,name:'Ù… / ÙƒØ±ÙŠÙ…'},{id:2,name:'Ù… / Ù†ÙˆØ±'}],
      halaqat:[{id:1,name:'Ø§Ù„Ø­Ù„Ù‚Ø© 1',teacher:1},{id:2,name:'Ø§Ù„Ø­Ù„Ù‚Ø© 2',teacher:2}],
      packages:[{id:1,title:'Ø¨Ø§Ù‚Ø§Øª ÙØ±Ø¯ÙŠ - Ø´Ù‡Ø±ÙŠ',price:200,duration:30,type:'ÙØ±Ø¯ÙŠ'},{id:2,title:'Ø¨Ø§Ù‚Ø§Øª Ø­Ù„Ù‚Ø© - Ø´Ù‡Ø±ÙŠ',price:1000,duration:30,type:'Ø­Ù„Ù‚Ø©'}],
      payments: [{id:1,studentId:1,packageId:1,amount:200,date:'2025-01-11'}]
    };

    function $(s) {return document.querySelector(s)}
    function $all(s){return document.querySelectorAll(s)}

    // Page switching
    function openPage(page){
      document.querySelectorAll('.page').forEach(p=>p.style.display='none');
      const el = document.getElementById('page-'+page);
      if(el) el.style.display='block';
      renderActivePage();
    }
    openPage('dashboard');

    function renderActivePage(){
      // global search
      const q = document.getElementById('globalSearch').value.trim();
      renderKPIs();
      renderStudentsTable(q);
      renderStudentsFullTable(q);
      renderPackages();
      renderPayments();
      renderChart();
    }

    function renderKPIs(){
      $('#kpiStudents').textContent = db.students.length;
      $('#kpiTeachers').textContent = db.teachers.length;
      $('#kpiHalaqat').textContent = db.halaqat.length;
      $('#kpiActiveSubs').textContent = db.payments.length;
      $('#countSubscribers').textContent = db.payments.length;
      // financials
      const total = db.payments.reduce((s,p)=>s+p.amount,0);
      $('#totalPayments').textContent = total;
      $('#duePayments').textContent = 0; // demo
    }

    function renderStudentsTable(q=''){
      const tbody = document.querySelector('#studentsTable tbody'); tbody.innerHTML='';
      const list = db.students.filter(s => !q || s.name.includes(q) || s.phone.includes(q));
      list.slice(0,6).forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.name}</td><td>${s.phone}</td><td>${s.status}</td><td>${s.packageId?db.packages.find(p=>p.id===s.packageId).title:'-'} </td><td><button class='btn ghost' onclick='openAssign(${s.id})'>Ø§Ø¯Ø§Ø±Ø©</button></td>`;
        tbody.appendChild(tr);
      });
    }

    function renderStudentsFullTable(q=''){
      const tbody = document.querySelector('#studentsFullTable tbody'); tbody.innerHTML='';
      const list = db.students.filter(s => !q || s.name.includes(q) || s.phone.includes(q));
      list.forEach(s =>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.name}</td><td>${s.phone}</td><td>${s.joined}</td><td>${s.status}</td><td>${s.halaqa}</td><td>${s.packageId?db.packages.find(p=>p.id===s.packageId).title:'-'}</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderPackages(){
      const tbody = document.querySelector('#packagesTable tbody'); tbody.innerHTML='';
      db.packages.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.title}</td><td>${p.price}</td><td>${p.duration}</td><td>${p.type}</td><td><button class='btn ghost' onclick='editPackage(${p.id})'>ØªØ¹Ø¯ÙŠÙ„</button> <button class='btn ghost' onclick='deletePackage(${p.id})'>Ø­Ø°Ù</button></td>`;
        tbody.appendChild(tr);
      });
    }

    function renderPayments(){
      const tbody = document.querySelector('#paymentsTable tbody'); tbody.innerHTML='';
      db.payments.forEach(pay =>{
        const student = db.students.find(s=>s.id===pay.studentId)||{name:'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'};
        const pack = db.packages.find(p=>p.id===pay.packageId)||{title:'-'};
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${student.name}</td><td>${pack.title}</td><td>${pay.amount}</td><td>${pay.date}</td>`;
        tbody.appendChild(tr);
      })
    }

    // modal management
    function openModal(name){
      const backdrop = document.getElementById('modalBackdrop');
      const content = document.getElementById('modalContent');
      if(name==='createStudent'){
        content.innerHTML = `\n          <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>\n          <div style='display:flex;flex-direction:column;gap:8px;margin-top:8px'>\n            <input id='newName' placeholder='Ø§Ù„Ø§Ø³Ù…' />\n            <input id='newPhone' placeholder='Ø§Ù„Ù‡Ø§ØªÙ' />\n            <div style='display:flex;gap:8px;justify-content:flex-end'>\n              <button class='btn' onclick='saveStudent()'>Ø­ÙØ¸</button>\n              <button class='btn ghost' onclick='closeModal()'>Ø¥Ù„ØºØ§Ø¡</button>\n            </div>\n          </div>`;
      } else if(name==='createPackage'){
        content.innerHTML = `\n          <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ù‚Ø©</h3>\n          <div style='display:flex;flex-direction:column;gap:8px;margin-top:8px'>\n            <input id='pkgTitle' placeholder='Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©' />\n            <input id='pkgPrice' placeholder='Ø§Ù„Ø³Ø¹Ø±' type='number' />\n            <input id='pkgDuration' placeholder='Ø§Ù„Ù…Ø¯Ø© (ÙŠÙˆÙ…)' type='number' />\n            <select id='pkgType'><option value='ÙØ±Ø¯ÙŠ'>ÙØ±Ø¯ÙŠ</option><option value='Ø­Ù„Ù‚Ø©'>Ø­Ù„Ù‚Ø©</option></select>\n            <div style='display:flex;gap:8px;justify-content:flex-end'>\n              <button class='btn' onclick='savePackage()'>Ø­ÙØ¸</button>\n              <button class='btn ghost' onclick='closeModal()'>Ø¥Ù„ØºØ§Ø¡</button>\n            </div>\n          </div>`;
      }
      backdrop.style.display='flex';
    }
    function closeModal(){document.getElementById('modalBackdrop').style.display='none'}

    function saveStudent(){
      const name = $('#newName').value.trim(); const phone = $('#newPhone').value.trim();
      if(!name) return alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨');
      const id = Date.now();
      db.students.push({id,name,phone,joined:new Date().toISOString().slice(0,10),status:'Ù†Ø´Ø·',halaqa:'',packageId:null});
      closeModal(); renderActivePage();
    }

    function savePackage(){
      const title = $('#pkgTitle').value.trim(); const price = Number($('#pkgPrice').value); const duration = Number($('#pkgDuration').value); const type = $('#pkgType').value;
      if(!title||!price) return alert('Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†');
      const id = Date.now(); db.packages.push({id,title,price,duration,type}); closeModal(); renderActivePage();
    }

    function editPackage(id){
      const p = db.packages.find(x=>x.id===id); if(!p) return; openModal('createPackage');
      setTimeout(()=>{ $('#pkgTitle').value=p.title; $('#pkgPrice').value=p.price; $('#pkgDuration').value=p.duration; $('#pkgType').value=p.type },50);
    }
    function deletePackage(id){ if(!confirm('Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø©ØŸ')) return; db.packages = db.packages.filter(x=>x.id!==id); renderActivePage(); }

    function openAssign(studentId){
      const s = db.students.find(x=>x.id===studentId);
      const content = document.getElementById('modalContent');
      document.getElementById('modalBackdrop').style.display='flex';
      content.innerHTML = `<h3>Ø§Ø¯Ø§Ø±Ø© ${s.name}</h3><div style='display:flex;flex-direction:column;gap:8px;margin-top:8px'>\n        <label>Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø©</label>\n        <select id='assignPkg'>${db.packages.map(p=>`<option value='${p.id}'>${p.title} - ${p.price}</option>`).join('')}</select>\n        <div style='display:flex;gap:8px;justify-content:flex-end;margin-top:6px'>\n          <button class='btn' onclick='assignPackage(${s.id})'>Ø­ÙØ¸</button>\n          <button class='btn ghost' onclick='closeModal()'>Ø¥Ù„ØºØ§Ø¡</button>\n        </div>\n      </div>`;
    }
    function assignPackage(studentId){ const pkgId = Number($('#assignPkg').value); const s = db.students.find(x=>x.id===studentId); s.packageId = pkgId; db.payments.push({id:Date.now(),studentId,packageId:pkgId,amount:db.packages.find(p=>p.id===pkgId).price,date:new Date().toISOString().slice(0,10)}); closeModal(); renderActivePage(); }

    function exportCSV(kind){
      if(kind==='students'){
        const rows = [['name,phone,joined,status,halaqa,package']];
        const csv = ['Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù‡Ø§ØªÙ,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„Ø­Ù„Ù‚Ø©,Ø§Ù„Ø¨Ø§Ù‚Ø©'];
        db.students.forEach(s=> csv.push(`${s.name},${s.phone},${s.joined},${s.status},${s.halaqa},${s.packageId?db.packages.find(p=>p.id===s.packageId).title:'-'}`));
        const blob = new Blob([csv.join('\n')],{type:'text/csv'});
        const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='students.csv'; a.click(); URL.revokeObjectURL(url);
      }
    }

    // Simple chart (no external libs) - demo line chart
    function renderChart(){
      const canvas = document.getElementById('chartProgress'); const ctx = canvas.getContext('2d');
      // sample weekly data
      const data=[3,5,4,6,7,8,9];
      const w = canvas.width; const h = canvas.height; ctx.clearRect(0,0,w,h);
      // axes
      ctx.beginPath(); ctx.moveTo(30,10); ctx.lineTo(30,h-20); ctx.lineTo(w-10,h-20); ctx.strokeStyle='#e6eef6'; ctx.stroke();
      // draw line
      const max = Math.max(...data)+2; ctx.beginPath();
      data.forEach((val,i)=>{
        const x = 30 + (i*(w-50)/(data.length-1));
        const y = (h-20) - ( (h-40)*(val/max) );
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        ctx.fillRect(x-2,y-2,4,4);
      }); ctx.strokeStyle=varOr('#0ea5a4','#0ea5a4'); ctx.stroke();
    }
    function varOr(a,b){return a||b}

    // initial render
    renderActivePage();

  </script>
</body>
</html>
